<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è Test WebSocket VLESS Connection</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            margin: 0;
            padding: 20px;
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #00ff88;
        }
        
        .status-error {
            border-left-color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
        }
        
        .status-warning {
            border-left-color: #ffa502;
            background: rgba(255, 165, 2, 0.1);
        }
        
        .status-success {
            border-left-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }
        
        .button {
            background: linear-gradient(45deg, #00ff88, #00d4ff);
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.3);
        }
        
        .button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .log-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 5px;
        }
        
        .log-info { color: #74b9ff; }
        .log-success { color: #00ff88; }
        .log-error { color: #ff4757; }
        .log-warning { color: #ffa502; }
        
        .config-info {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #00ff88, #00d4ff);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è Test WebSocket VLESS Connection</h1>
            <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä—è–º–æ–≥–æ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VLESS —Å–µ—Ä–≤–µ—Ä—É</p>
        </div>
        
        <div class="config-info">
            <h3>üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è VLESS:</h3>
            <div><strong>–ê–¥—Ä–µ—Å:</strong> 95.181.173.120</div>
            <div><strong>–ü–æ—Ä—Ç:</strong> 8444 (WebSocket)</div>
            <div><strong>UUID:</strong> 89462a65-fafa-4f9a-9efd-2be01a001778</div>
            <div><strong>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç:</strong> WebSocket</div>
            <div><strong>–ü—É—Ç—å:</strong> /</div>
            <div><strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</strong> none</div>
        </div>
        
        <div class="status-card" id="status">
            <h3>üìä –°—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:</h3>
            <div id="connection-status">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>
        </div>
        
        <div style="text-align: center;">
            <button class="button" id="connect-btn" onclick="testConnection()">
                üöÄ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç WebSocket VLESS
            </button>
            <button class="button" id="disconnect-btn" onclick="disconnect()" disabled>
                üîå –û—Ç–∫–ª—é—á–∏—Ç—å—Å—è
            </button>
        </div>
        
        <div class="log-container" id="log-container">
            <div class="log-entry log-info">üìã –õ–æ–≥ –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø–∏—Å–∏...</div>
        </div>
        
        <div class="status-card">
            <h3>üîß –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ —à–∞–≥–∏:</h3>
            <div id="test-steps">
                <div>1. ‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket</div>
                <div>2. ‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ VLESS handshake</div>
                <div>3. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞</div>
                <div>4. ‚è≥ –¢–µ—Å—Ç keepalive –ø–∏–Ω–≥–∞</div>
                <div>5. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏</div>
            </div>
        </div>
    </div>
    
    <script src="vless-protocol.js"></script>
    <script>
        let vlessClient = null;
        let testInterval = null;
        let stepIndex = 0;
        const steps = [
            "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket",
            "–û—Ç–ø—Ä–∞–≤–∫–∞ VLESS handshake", 
            "–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞",
            "–¢–µ—Å—Ç keepalive –ø–∏–Ω–≥–∞",
            "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏"
        ];
        
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-container');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('connection-status');
            const statusCard = document.getElementById('status');
            
            statusDiv.textContent = message;
            
            // Update card style
            statusCard.className = 'status-card';
            if (type === 'error') statusCard.classList.add('status-error');
            else if (type === 'warning') statusCard.classList.add('status-warning');
            else if (type === 'success') statusCard.classList.add('status-success');
        }
        
        function updateProgress(percentage) {
            document.getElementById('progress').style.width = percentage + '%';
        }
        
        function updateStep(index, status) {
            const stepsDiv = document.getElementById('test-steps');
            const stepElements = stepsDiv.children;
            
            if (stepElements[index]) {
                let icon = '';
                switch (status) {
                    case 'progress': icon = 'üîÑ'; break;
                    case 'success': icon = '‚úÖ'; break;
                    case 'error': icon = '‚ùå'; break;
                    default: icon = '‚è≥'; break;
                }
                
                stepElements[index].innerHTML = `${index + 1}. ${icon} ${steps[index]}`;
            }
        }
        
        async function testConnection() {
            try {
                document.getElementById('connect-btn').disabled = true;
                document.getElementById('disconnect-btn').disabled = false;
                
                log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç WebSocket VLESS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...', 'info');
                updateStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...', 'warning');
                updateProgress(10);
                
                // Step 1: WebSocket connection
                updateStep(0, 'progress');
                log('üîÑ –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VLESS WebSocket —Å–µ—Ä–≤–µ—Ä—É...', 'info');
                
                vlessClient = new VLESSClient({
                    address: '95.181.173.120',
                    port: 8444,
                    uuid: '89462a65-fafa-4f9a-9efd-2be01a001778',
                    transport: 'ws',
                    path: '/',
                    security: 'none'
                });
                
                // Setup handlers
                vlessClient.onData = (data) => {
                    log(`üì¶ –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ VLESS: ${data.length} –±–∞–π—Ç`, 'success');
                    updateStep(2, 'success');
                    updateProgress(70);
                };
                
                vlessClient.onClose = () => {
                    log('üîå VLESS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ', 'warning');
                    updateStatus('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ', 'warning');
                };
                
                vlessClient.onError = (error) => {
                    log(`‚ùå –û—à–∏–±–∫–∞ VLESS: ${error.message}`, 'error');
                    updateStatus('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
                    updateStep(stepIndex, 'error');
                };
                
                updateProgress(30);
                
                // Connect
                await vlessClient.connect();
                
                updateStep(0, 'success');
                updateStep(1, 'success'); // Handshake happens in connect()
                updateProgress(50);
                
                log('‚úÖ VLESS WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
                updateStatus('WebSocket VLESS –ø–æ–¥–∫–ª—é—á–µ–Ω', 'success');
                
                // Step 3: Test keepalive
                updateStep(3, 'progress');
                log('üîÑ –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä—É–µ–º keepalive –ø–∏–Ω–≥...', 'info');
                
                setTimeout(() => {
                    if (vlessClient && vlessClient.isConnected()) {
                        vlessClient.send('test-ping');
                        log('üì° –û—Ç–ø—Ä–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç –ø–∏–Ω–≥ —á–µ—Ä–µ–∑ VLESS WebSocket', 'info');
                        updateStep(3, 'success');
                        updateProgress(80);
                        
                        // Step 4: Stability test
                        updateStep(4, 'progress');
                        log('üîÑ –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...', 'info');
                        
                        setTimeout(() => {
                            if (vlessClient && vlessClient.isConnected()) {
                                updateStep(4, 'success');
                                updateProgress(100);
                                log('üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´! VLESS WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ!', 'success');
                                updateStatus('‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!', 'success');
                                
                                // Start continuous monitoring
                                testInterval = setInterval(() => {
                                    if (vlessClient && vlessClient.isConnected()) {
                                        vlessClient.send('heartbeat');
                                        log('üíì Heartbeat –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'info');
                                    }
                                }, 5000);
                                
                            } else {
                                updateStep(4, 'error');
                                log('‚ùå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏', 'error');
                                updateStatus('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ', 'error');
                            }
                        }, 2000);
                        
                    } else {
                        updateStep(3, 'error');
                        log('‚ùå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º –ø–∏–Ω–≥–∞', 'error');
                        updateStatus('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ', 'error');
                    }
                }, 1500);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ${error.message}`, 'error');
                updateStatus(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                updateStep(stepIndex, 'error');
                document.getElementById('connect-btn').disabled = false;
                document.getElementById('disconnect-btn').disabled = true;
            }
        }
        
        function disconnect() {
            if (testInterval) {
                clearInterval(testInterval);
                testInterval = null;
            }
            
            if (vlessClient) {
                vlessClient.close();
                vlessClient = null;
            }
            
            log('üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º', 'info');
            updateStatus('–û—Ç–∫–ª—é—á–µ–Ω–æ', 'warning');
            updateProgress(0);
            
            // Reset steps
            for (let i = 0; i < steps.length; i++) {
                updateStep(i, 'pending');
            }
            
            document.getElementById('connect-btn').disabled = false;
            document.getElementById('disconnect-btn').disabled = true;
        }
        
        // Initialize
        log('üõ°Ô∏è –¢–µ—Å—Ç–µ—Ä WebSocket VLESS –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
        log('üìã –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VLESS —Å–µ—Ä–≤–µ—Ä—É', 'info');
        log('üîß –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ VLESS —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ 95.181.173.120:8444 —Å WebSocket —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º', 'warning');
    </script>
</body>
</html>