#!/bin/bash

# =============================================================================
# üîß –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï TURN –°–ï–†–í–ï–†–ê –î–õ–Ø –†–û–°–°–ò–ô–°–ö–ò–• –ú–û–ë–ò–õ–¨–ù–´–• –°–ï–¢–ï–ô
# =============================================================================
# –ó–∞–ø—É—Å–∫: bash fix-turn-server.sh
# –°–µ—Ä–≤–µ—Ä: 94.198.218.189
# –ü–æ—Ä—Ç—ã: 3478 (TURN), 10000-20000 (relay)

set -e  # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ª–Ω—É—é –ø–µ—Ä–µ—Å–±–æ—Ä–∫—É TURN —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π..."
echo "üìÖ $(date)"
echo "üåç IP —Å–µ—Ä–≤–µ—Ä–∞: $(curl -s ifconfig.me || echo '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å IP')"
echo ""

# =============================================================================
# üõë –®–ê–ì 1: –ü–û–õ–ù–ê–Ø –û–ß–ò–°–¢–ö–ê –°–¢–ê–†–û–ô –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
# =============================================================================
echo "üõë –®–ê–ì 1: –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π coturn..."

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Ä–≤–∏—Å
systemctl stop coturn 2>/dev/null || echo "coturn —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
systemctl disable coturn 2>/dev/null || echo "coturn —É–∂–µ –æ—Ç–∫–ª—é—á–µ–Ω"

# –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ–º –ø–∞–∫–µ—Ç –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
apt-get remove --purge coturn -y 2>/dev/null || echo "coturn —É–∂–µ —É–¥–∞–ª–µ–Ω"
apt-get autoremove -y

# –£–¥–∞–ª—è–µ–º –æ—Å—Ç–∞—Ç–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
rm -rf /etc/turnserver.conf
rm -rf /var/log/turnserver.log
rm -rf /var/lib/turn
rm -rf /etc/default/coturn

echo "‚úÖ –°—Ç–∞—Ä—ã–π coturn –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω"
echo ""

# =============================================================================
# üîÑ –®–ê–ì 2: –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–ò–°–¢–ï–ú–´ –ò –£–°–¢–ê–ù–û–í–ö–ê
# =============================================================================
echo "üîÑ –®–ê–ì 2: –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º coturn –∑–∞–Ω–æ–≤–æ..."

# –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–∫–µ—Ç—ã
apt-get update

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º coturn
DEBIAN_FRONTEND=noninteractive apt-get install coturn -y

echo "‚úÖ coturn —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∑–∞–Ω–æ–≤–æ"
echo ""

# =============================================================================
# üîß –®–ê–ì 3: –°–û–ó–î–ê–ù–ò–ï –û–ü–¢–ò–ú–ê–õ–¨–ù–û–ô –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
# =============================================================================
echo "üîß –®–ê–ì 3: –°–æ–∑–¥–∞–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π..."

# –ü–æ–ª—É—á–∞–µ–º –≤–Ω–µ—à–Ω–∏–π IP —Å–µ—Ä–≤–µ—Ä–∞
EXTERNAL_IP=$(curl -s ifconfig.me || curl -s ipinfo.io/ip || echo "94.198.218.189")
echo "üåê –í–Ω–µ—à–Ω–∏–π IP: $EXTERNAL_IP"

# –°–æ–∑–¥–∞–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cat > /etc/turnserver.conf << 'EOF'
# =============================================================================
# üá∑üá∫ –û–ü–¢–ò–ú–ê–õ–¨–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø COTURN –î–õ–Ø –†–û–°–°–ò–ô–°–ö–ò–• –ú–û–ë–ò–õ–¨–ù–´–• –°–ï–¢–ï–ô
# =============================================================================

# üåê –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
listening-port=3478
tls-listening-port=5349
listening-ip=0.0.0.0
listening-device=eth0

# üéØ IP –∞–¥—Ä–µ—Å–∞ (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!)
relay-ip=EXTERNAL_IP_PLACEHOLDER
external-ip=EXTERNAL_IP_PLACEHOLDER

# üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
lt-cred-mech
use-auth-secret
static-auth-secret=russian-mobile-networks-secret-key-2025
realm=malmik5482-videocall-fc69.twc1.net

# üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å WebRTC
user=webrtc:pRr45XBJgdff9Z2Q4EdTLwOUyqudQjtN

# üö™ –î–∏–∞–ø–∞–∑–æ–Ω –ø–æ—Ä—Ç–æ–≤ –¥–ª—è relay (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö NAT)
min-port=10000
max-port=30000

# üì± –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π
no-stun-backward-compatibility
mobility
tcp-proxy-port=3478

# üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
denied-peer-ip=0.0.0.0-0.255.255.255
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.168.0.0-192.168.255.255

# ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
max-bps=10000000
total-quota=0
user-quota=0
stale-nonce=600

# üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
verbose
log-file=/var/log/turnserver.log
pidfile=/var/run/turnserver.pid
new-log-timestamp
simple-log

# üö´ –û—Ç–∫–ª—é—á–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
no-cli
no-tlsv1
no-tlsv1_1
no-dtls
no-multicast-peers

# üéÆ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
fingerprint
lt-cred-mech
use-auth-secret
no-stdout-log

# üá∑üá∫ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
# –ú–¢–°, –ë–∏–ª–∞–π–Ω, –ú–µ–≥–∞—Ñ–æ–Ω, Tele2 - —Å–ª–æ–∂–Ω—ã–π NAT
cipher-list="ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS"

EOF

# –ó–∞–º–µ–Ω—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π IP
sed -i "s/EXTERNAL_IP_PLACEHOLDER/$EXTERNAL_IP/g" /etc/turnserver.conf

echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ —Å –≤–Ω–µ—à–Ω–∏–º IP: $EXTERNAL_IP"
echo ""

# =============================================================================
# üî• –®–ê–ì 4: –ù–ê–°–¢–†–û–ô–ö–ê FIREWALL
# =============================================================================
echo "üî• –®–ê–ì 4: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º firewall –¥–ª—è TURN —Å–µ—Ä–≤–µ—Ä–∞..."

# –í–∫–ª—é—á–∞–µ–º ufw –µ—Å–ª–∏ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
ufw --force enable

# –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ TURN –ø–æ—Ä—Ç—ã
ufw allow 3478/tcp comment "TURN TCP"
ufw allow 3478/udp comment "TURN UDP" 
ufw allow 5349/tcp comment "TURN TLS"

# –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è relay (—Ä–æ—Å—Å–∏–π—Å–∫–∏–µ NAT —Ç—Ä–µ–±—É—é—Ç –º–Ω–æ–≥–æ –ø–æ—Ä—Ç–æ–≤)
ufw allow 10000:30000/udp comment "TURN relay range"

# –û—Ç–∫—Ä—ã–≤–∞–µ–º SSH —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø
ufw allow 22/tcp comment "SSH"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
echo "üî• –°—Ç–∞—Ç—É—Å firewall:"
ufw status numbered

echo "‚úÖ Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
echo ""

# =============================================================================
# üéõÔ∏è –®–ê–ì 5: –ù–ê–°–¢–†–û–ô–ö–ê –°–ò–°–¢–ï–ú–ù–´–• –°–ï–†–í–ò–°–û–í
# =============================================================================
echo "üéõÔ∏è –®–ê–ì 5: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã..."

# –í–∫–ª—é—á–∞–µ–º coturn –≤ /etc/default/coturn
echo 'TURNSERVER_ENABLED=1' > /etc/default/coturn

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã
chown turnserver:turnserver /etc/turnserver.conf
chmod 640 /etc/turnserver.conf
chmod 755 /var/log/
touch /var/log/turnserver.log
chown turnserver:turnserver /var/log/turnserver.log

# –°–æ–∑–¥–∞–µ–º systemd override –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
mkdir -p /etc/systemd/system/coturn.service.d/
cat > /etc/systemd/system/coturn.service.d/override.conf << 'EOF'
[Service]
Restart=always
RestartSec=10
LimitNOFILE=65536

[Unit]
After=network-online.target
Wants=network-online.target
EOF

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º systemd
systemctl daemon-reload

echo "‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"
echo ""

# =============================================================================
# üöÄ –®–ê–ì 6: –ó–ê–ü–£–°–ö –ò –ü–†–û–í–ï–†–ö–ê
# =============================================================================
echo "üöÄ –®–ê–ì 6: –ó–∞–ø—É—Å–∫–∞–µ–º TURN —Å–µ—Ä–≤–µ—Ä..."

# –ó–∞–ø—É—Å–∫–∞–µ–º –∏ –≤–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
systemctl enable coturn
systemctl start coturn

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞
sleep 3

echo "‚úÖ TURN —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω"
echo ""

# =============================================================================
# üîç –®–ê–ì 7: –ö–û–ú–ü–õ–ï–ö–°–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê
# =============================================================================
echo "üîç –®–ê–ì 7: –ü—Ä–æ–≤–æ–¥–∏–º –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É..."

echo "üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ coturn:"
systemctl status coturn --no-pager -l || echo "‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º"

echo ""
echo "üåê –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–ª—É—à–∞–µ—Ç –Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö –ø–æ—Ä—Ç–∞—Ö:"
netstat -tuln | grep 3478 || echo "‚ùå –ü–æ—Ä—Ç 3478 –Ω–µ —Å–ª—É—à–∞–µ—Ç—Å—è"

echo ""
echo "üî• –°—Ç–∞—Ç—É—Å firewall:"
ufw status | grep 3478 || echo "‚ùå –ü–æ—Ä—Ç—ã –Ω–µ –æ—Ç–∫—Ä—ã—Ç—ã –≤ firewall"

echo ""
echo "üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤ coturn:"
tail -10 /var/log/turnserver.log 2>/dev/null || echo "‚ùå –õ–æ–≥ —Ñ–∞–π–ª –ø—É—Å—Ç –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

echo ""
echo "üíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:"
ps aux | grep turnserver | head -3 || echo "‚ùå –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω"

echo ""

# =============================================================================
# üß™ –®–ê–ì 8: –¢–ï–°–¢ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø
# =============================================================================
echo "üß™ –®–ê–ì 8: –¢–µ—Å—Ç–∏—Ä—É–µ–º TURN —Å–µ—Ä–≤–µ—Ä..."

# –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç TCP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
if timeout 5 bash -c "</dev/tcp/$EXTERNAL_IP/3478" 2>/dev/null; then
    echo "‚úÖ TCP –ø–æ—Ä—Ç 3478 –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ"
else
    echo "‚ùå TCP –ø–æ—Ä—Ç 3478 –ù–ï –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ - –ü–†–û–ë–õ–ï–ú–ê!"
fi

# –¢–µ—Å—Ç UDP (–ø—Ä–∏–º–µ—Ä–Ω—ã–π)
if ss -tuln | grep -q ":3478.*0.0.0.0"; then
    echo "‚úÖ UDP –ø–æ—Ä—Ç 3478 —Å–ª—É—à–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö"  
else
    echo "‚ùå UDP –ø–æ—Ä—Ç 3478 —Å–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ localhost - –ü–†–û–ë–õ–ï–ú–ê!"
fi

echo ""

# =============================================================================
# üìã –®–ê–ì 9: –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢
# =============================================================================
echo "üìã –®–ê–ì 9: –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç..."

echo "=============================================================================="
echo "üéâ –£–°–¢–ê–ù–û–í–ö–ê TURN –°–ï–†–í–ï–†–ê –ó–ê–í–ï–†–®–ï–ù–ê!"
echo "=============================================================================="
echo "üìÖ –í—Ä–µ–º—è: $(date)"
echo "üåê –í–Ω–µ—à–Ω–∏–π IP: $EXTERNAL_IP" 
echo "üö™ TURN –ø–æ—Ä—Ç: 3478 (UDP/TCP)"
echo "üîê –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: webrtc"
echo "üîë –ü–∞—Ä–æ–ª—å: pRr45XBJgdff9Z2Q4EdTLwOUyqudQjtN"
echo "üìä –î–∏–∞–ø–∞–∑–æ–Ω relay: 10000-30000/UDP"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã
ISSUES_FOUND=0

echo "üîç –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–í–ï–†–ö–ò:"

if systemctl is-active --quiet coturn; then
    echo "‚úÖ coturn —Å–µ—Ä–≤–∏—Å: –ê–ö–¢–ò–í–ï–ù"
else
    echo "‚ùå coturn —Å–µ—Ä–≤–∏—Å: –ù–ï –ê–ö–¢–ò–í–ï–ù - –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê!"
    ISSUES_FOUND=$((ISSUES_FOUND + 1))
fi

if netstat -tuln | grep -q "0.0.0.0:3478"; then
    echo "‚úÖ –ü–æ—Ä—Ç 3478: —Å–ª—É—à–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö"
else
    echo "‚ùå –ü–æ—Ä—Ç 3478: —Å–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ localhost - –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê!"  
    ISSUES_FOUND=$((ISSUES_FOUND + 1))
fi

if ufw status | grep -q "3478"; then
    echo "‚úÖ Firewall: –ø–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã"
else
    echo "‚ùå Firewall: –ø–æ—Ä—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã - –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê!"
    ISSUES_FOUND=$((ISSUES_FOUND + 1))  
fi

if [ -f "/etc/turnserver.conf" ] && grep -q "webrtc" /etc/turnserver.conf; then
    echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å webrtc –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
else
    echo "‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å webrtc –ù–ï –Ω–∞—Å—Ç—Ä–æ–µ–Ω - –ü–†–û–ë–õ–ï–ú–ê!"
    ISSUES_FOUND=$((ISSUES_FOUND + 1))
fi

echo ""
if [ $ISSUES_FOUND -eq 0 ]; then
    echo "üéØ –†–ï–ó–£–õ–¨–¢–ê–¢: –í–°–ï –û–¢–õ–ò–ß–ù–û! TURN —Å–µ—Ä–≤–µ—Ä –≥–æ—Ç–æ–≤ –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π! üöÄ"
    echo ""
    echo "üì± –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:"
    echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à–µ VideoChat –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
    echo "2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ üîç"  
    echo "3. –î–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å –æ—Ü–µ–Ω–∫—É A –∏–ª–∏ B+"
    echo "4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–≤–æ–Ω–æ–∫ –º–µ–∂–¥—É –º–æ–±–∏–ª—å–Ω—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏"
    echo ""
    echo "üéä –ö–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ –¥–æ–ª–∂–Ω–æ —Å—Ç–∞—Ç—å –æ—Ç–ª–∏—á–Ω—ã–º!"
else
    echo "‚ö†Ô∏è –†–ï–ó–£–õ–¨–¢–ê–¢: –ù–∞–π–¥–µ–Ω–æ $ISSUES_FOUND –ø—Ä–æ–±–ª–µ–º(—ã). –°–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ –≤—ã—à–µ."
    echo ""
    echo "üîß –ö–û–ú–ê–ù–î–´ –î–õ–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò:"
    echo "systemctl status coturn"
    echo "journalctl -u coturn -f"
    echo "netstat -tuln | grep 3478"
    echo "tail -f /var/log/turnserver.log"
fi

echo ""
echo "üìñ –ü–û–õ–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø: —Å–º. —Ñ–∞–π–ª TURN_SERVER_SETUP.md –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏"
echo "üÜò –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ journalctl -u coturn -f"
echo "=============================================================================="

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
echo ""
echo "üìÑ –ò–¢–û–ì–û–í–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø /etc/turnserver.conf:"
echo "=============================================================================="
head -20 /etc/turnserver.conf
echo "... (–æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤ —Ñ–∞–π–ª–µ)"
echo "=============================================================================="

exit 0